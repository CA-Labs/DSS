/*! modaclouds-dss - v0.0.1 - author: Jacek Dominiak - 2014-08-25 */
$("#dssSlides").carousel("pause",{wrap:!1,interval:!1}).on("slid.bs.carousel",function(){var a=$(".topMenu"),b=$(this).find(".active"),c=$(".sticky-bottom"),d=c.find(".slide-services");a.find("blockquote p").removeClass("active"),b.hasClass("bsoia-slide")?(a.find(".bsoia-slide blockquote p").addClass("active"),c.find(".slide-prev").prop("disabled",!0),c.find(".slide-next").prop("disabled",!1),c.find(".slide-next").css("display","inline"),d.css("display","none")):b.hasClass("toia-slide")?(a.find(".toia-slide blockquote p").addClass("active"),c.find(".slide-prev").prop("disabled",!1),c.find(".slide-next").prop("disabled",!1),c.find(".slide-next").css("display","inline"),d.css("display","none")):b.hasClass("ta-slide")?(a.find(".ta-slide blockquote p").addClass("active"),c.find(".slide-prev").prop("disabled",!1),c.find(".slide-next").prop("disabled",!1),c.find(".slide-next").css("display","inline"),d.css("display","none")):b.hasClass("risks-slide")?(a.find(".risks-slide blockquote p").addClass("active"),c.find(".slide-prev").prop("disabled",!1),c.find(".slide-next").prop("disabled",!1),c.find(".slide-next").css("display","inline"),d.css("display","none")):b.hasClass("treatments-slide")?(a.find(".treatments-slide blockquote p").addClass("active"),c.find(".slide-prev").prop("disabled",!1),c.find(".slide-next").prop("disabled",!1),c.find(".slide-next").css("display","inline"),d.css("display","none")):(a.find(".services-slide blockquote p").addClass("active"),c.find(".slide-prev").prop("disabled",!1),c.find(".slide-next").css("display","none"),d.css("display","inline  "))});var dssApp=angular.module("dssApp",["ngStorage","angular-flash.service","angular-flash.flash-alert-directive","ngDragDrop","angular-loading-bar","angularFileUpload","frapontillo.bootstrap-switch","nouislider"]).config(["cfpLoadingBarProvider",function(a){a.includeSpinner=!1}]);$("body").on("mouseover",".list-group > .selected-asset",function(){$(this).find(".remove-asset").show(),$(this).find(".remove-bsoia-in-toia").show()}),$("body").on("mouseout",".list-group > .selected-asset",function(){$(this).find(".remove-asset").hide(),$(this).find(".remove-bsoia-in-toia").hide()}),$("body").on("mouseover",".list-group > .selected-risk",function(){$(this).find(".remove-risk").show()}),$("body").on("mouseout",".list-group > .selected-risk",function(){$(this).find(".remove-risk").hide()}),$("body").on("mouseover",".list-group > .dropzone",function(){$(this).find(".remove-bsoia-in-toia-asset").show()}),$("body").on("mouseout",".list-group > .dropzone",function(){$(this).find(".remove-bsoia-in-toia-asset").hide()}),$("body").on("mouseover",".list-group > .selected-treatment",function(){$(this).find(".remove-treatment").show()}),$("body").on("mouseout",".list-group > .selected-treatment",function(){$(this).find(".remove-treatment").hide()}),$('select[label="assets"]').select2({placeholder:"Select an asset"}),$('select[label="risks"]').select2({placeholder:"Select a risk"}),$('select[label="treatments"]').select2({placeholder:"Select a treatment"}),dssApp.controller("bsoiaController",["$scope","$rootScope","$localStorage","AssetsService","ArangoDBService","flash",function(a,b,c,d,e,f){a.bsoiaAssets=[],a.bsoiaAssetsSelected=d.getBSOIA(),a.addBsoiaAsset=function(a){d.addBSOIA(a)},a.removeBsoiaAsset=function(a){d.removeBSOIA(a)},a.$watch(function(){return d.getBSOIA()},function(){b.$broadcast("bsoiaChanged")},!0),e.getBSOIA(function(b,c){b?f.error="An error occurred while trying to fetch BSOIA assets from database":a.bsoiaAssets=c})}]),dssApp.controller("toiaController",["$scope","$rootScope","$localStorage","AssetsService","ArangoDBService","flash",function(a,b,c,d,e,f){a.toiaAssets=[],a.toiaAssetsSelected=d.getTOIA(),a.bsoiaAssetsSelected=d.getBSOIA(),a.addToiaAsset=function(a){d.addTOIA(a)},a.removeToiaAsset=function(a){d.removeTOIA(a)},a.removeBsoiaFromToiaAsset=function(a,b){d.removeBSOIAfromTOIA(a.name,b.asset.name)},a.bsoiaDropped=function(a,b,c){d.existsBSOIAinTOIA(b.name,c.asset.name)?f.warn="BSOIA "+b.name+" already added in TOIA "+c.asset.name:(c.bsoiaRelations.push(b),d.updateTOIAbyName(c.asset.name,c))},a.isBsoiaEverUsed=function(a){return d.isBSOIALinked(a.name)},a.$watch(function(){return d.getTOIA()},function(){b.$broadcast("toiaChanged")},!0),e.getTOIA(function(b,c){b?f.error="An error occurred while trying to fetch BSOIA assets from database":a.toiaAssets=c})}]),dssApp.controller("taController",["$scope","AssetsService","$localStorage",function(a,b){a.taAssets=b.getTA(),a.removeTaAsset=function(a){b.removeTA(a)}}]),dssApp.controller("risksController",["$scope","$rootScope","$localStorage","ArangoDBService","flash","AssetsService","RisksService","$timeout","$interpolate",function(a,b,c,d,e,f,g){a.potentialRisks=[],a.risksSelected=g.getRisks(),a.multiple=!1,a.taAssets=f.getTA(),a.simpleRisksLikelihoodConsequence=g.getRisksLikelihoodConsequence(),a.multipleRisksLikelihoodConsequence=g.getRisksTALikelihoodConsequence();var h={VERY_LOW:{"class":"risk-very-low",name:"Very low"},LOW:{"class":"risk-low",name:"Low"},NORMAL:{"class":"risk-normal",name:"Normal"},HIGH:{"class":"risk-high",name:"High"},VERY_HIGH:{"class":"risk-very-high",name:"Very high"}},i=function(a){return 2>a?h.VERY_LOW.class:2==a||3==a?h.LOW.class:4==a||5==a||6==a?h.NORMAL.class:7==a||8==a?h.HIGH.class:a>8?h.VERY_HIGH.class:void 0},j=function(a){return 2>a?h.VERY_LOW.name:2==a||3==a?h.LOW.name:4==a||5==a||6==a?h.NORMAL.name:7==a||8==a?h.HIGH.name:a>8?h.VERY_HIGH.name:void 0},k=function(a){for(category in h)a.removeClass(h[category].class);return a};a.$watch(function(){return a.risksSelected},function(){b.$broadcast("risksSelectedChanged")},!0),a.$on("bsoiaChanged",function(){d.getPotentialRisks(function(b,c){if(b)e.error="Some error occurred when trying to compute potential risks after selected BSOIA changed";else{var d=[],f=[];_.each(c._documents,function(a){-1===d.indexOf(a.destination.name)&&(d.push(a.destination.name),f.push(a))}),a.potentialRisks=f}})}),a.$on("toiaChanged",function(){d.getPotentialRisks(function(b,c){if(b)e.error="Some error occurred when trying to compute potential risks after selected TOIA changed";else{var d=[],f=[];_.each(c._documents,function(a){-1===d.indexOf(a.destination.name)&&(d.push(a.destination.name),f.push(a))}),a.potentialRisks=f}})}),a.toggleActivation=function(){if(a.multiple){if(0==a.taAssets.length)return e.warn="You can't define risks per each tangible asset since you did not specify any of them",void(a.multiple=!1);a.multiple=!0}},a.$watch("taAssets",function(b,c){0==b.length&&(a.multiple=!1);var d=[],e=[];_.each(c,function(a){var c=!1;_.each(b,function(b){b.cloudResource._serviceName==a.cloudResource._serviceName&&(c=!0)}),c||d.push(a.cloudResource._serviceName)}),_.each(b,function(a){var b=!1;_.each(c,function(c){c.cloudResource._serviceName==a.cloudResource._serviceName&&(b=!0)}),b||e.push(a.cloudResource._serviceName)}),_.each(d,function(a){g.removeRiskTALikelihoodConsequence(a)}),_.each(e,function(b){_.each(a.risksSelected,function(c){var d=a.$eval("{"+c.destination.attributes+"}");g.addRiskTALikelihood(c.destination.name,b,d.start),g.addRiskTAConsequence(c.destination.name,b,d.start)})}),a.taAssets=b},!0),a.$watch("risksSelected",function(b,c){var d=[],e=[];_.each(c,function(a){var c=!1;_.each(b,function(b){b.destination.name==a.destination.name&&(c=!0)}),c||d.push(a.destination.name)}),_.each(b,function(b){var d=!1;if(_.each(c,function(a){a.destination.name==b.destination.name&&(d=!0)}),!d){var f=a.$eval("{"+b.destination.attributes+"}");e.push({name:b.destination.name,value:f.start})}}),_.each(d,function(a){g.removeRiskLikelihoodConsequence(a)}),_.each(e,function(b){g.addRiskLikelihood(b.name,b.value),g.addRiskConsequence(b.name,b.value),_.each(a.taAssets,function(a){g.addRiskTALikelihood(b.name,a.cloudResource._serviceName,b.value),g.addRiskTAConsequence(b.name,a.cloudResource._serviceName,b.value)})}),a.risksSelected=b},!0),a.addRisk=function(a){g.addRisk(a)},a.removeRisk=function(a){g.removeRisk(a)},a.$on("sliderValueChanged",function(b,c){var d=c.value;k(c.slider.children().first()).addClass(i(d)).text(j(d));var f=c.slider.data("hash-key"),h=f.split("_");if(h.length<2)return void(e.error="Incorrect hash key for slider value!");var l=h[0];if(a.multiple){var m=h[1],n=h[2];"likelihood"==n?g.addRiskTALikelihood(l,m,d):g.addRiskTAConsequence(l,m,d)}else{var n=h[1];"likelihood"==n?g.addRiskLikelihood(l,d):g.addRiskConsequence(l,d)}})}]),dssApp.controller("treatmentsController",["$scope","ArangoDBService","TreatmentsService","flash","$timeout",function(a,b,c,d){a.potentialTreatments=[],a.treatmentsSelected=c.getTreatments(),a.treatmentValues=c.getTreatmentsValues(),a.$on("risksSelectedChanged",function(){b.getPotentialTreatments(function(b,c){if(b)d.error="Some error occurred when trying to compute potential treatments after selected risks changed";else{var e=[],f=[];_.each(c._documents,function(a){-1===e.indexOf(a.destination.name)&&(e.push(a.destination.name),f.push(a))}),a.potentialTreatments=f}})}),a.$watch(function(){return a.treatmentsSelected},function(b,d){var e=[];_.each(d,function(a){var c=!1;_.each(b,function(b){b.destination.name==a.destination.name&&(c=!0)}),c||e.push(a.destination.name)}),_.each(e,function(a){c.removeTreatmentValue(a)}),a.treatmentsSelected=b},!0),a.$watch(function(){return a.treatmentValues},function(a,b){console.log("old",b),console.log("new",a)},!0),a.$on("treatmentValueChanged",function(a,b){c.addTreatmentValue(b.name,b.value)}),a.addTreatment=function(a){c.addTreatment(a)},a.removeTreatment=function(a){c.removeTreatment(a)}}]),$("body").on("mouseover",".form-group > .dropzone-container",function(){$(this).find(".remove-bsoia-in-toia-asset").show()}),$("body").on("mouseout",".form-group > .dropzone-container",function(){$(this).find(".remove-bsoia-in-toia-asset").hide()}),dssApp.controller("crudController",["$scope","ArangoDBService",function(a,b){a.modifyExisting=!1,a.characteristicData={},a.providerData={},a.metricData={},a.serviceData={},b.getAll("provider",function(b,c){a.providers=c}),a.metricsValues={},a.$watch("metricsValues",function(a){console.log(a)},!0),b.getAll("metric",function(b,c){a.metrics=c}),b.getAll("characteristic",function(b,c){a.characteristics=c}),a.characteristicLevels={1:"1st level",2:"2nd level",3:"3rd level"},a.showAssetPanel=!1,a.showRiskPanel=!1,a.showTreatmentPanel=!1,a.showCharacteristicPanel=!1,a.showServicePanel=!0,a.showMetricPanel=!1,a.showProviderPanel=!1,a.switchPanel=function(b){switch(b){case"asset":a.showRiskPanel=!1,a.showTreatmentPanel=!1,a.showCharacteristicPanel=!1,a.showServicePanel=!1,a.showProviderPanel=!1,a.showMetricPanel=!1,a.showAssetPanel=!0;break;case"risk":a.showTreatmentPanel=!1,a.showCharacteristicPanel=!1,a.showServicePanel=!1,a.showProviderPanel=!1,a.showMetricPanel=!1,a.showAssetPanel=!1,a.showRiskPanel=!0;break;case"treatment":a.showCharacteristicPanel=!1,a.showServicePanel=!1,a.showProviderPanel=!1,a.showMetricPanel=!1,a.showAssetPanel=!1,a.showRiskPanel=!1,a.showTreatmentPanel=!0;break;case"characteristic":a.showServicePanel=!1,a.showProviderPanel=!1,a.showMetricPanel=!1,a.showAssetPanel=!1,a.showRiskPanel=!1,a.showTreatmentPanel=!1,a.showCharacteristicPanel=!0;break;case"metric":a.showAssetPanel=!1,a.showRiskPanel=!1,a.showTreatmentPanel=!1,a.showCharacteristicPanel=!1,a.showServicePanel=!1,a.showProviderPanel=!1,a.showMetricPanel=!0;break;case"provider":a.showAssetPanel=!1,a.showRiskPanel=!1,a.showTreatmentPanel=!1,a.showCharacteristicPanel=!1,a.showServicePanel=!1,a.showMetricPanel=!1,a.showProviderPanel=!0;break;case"service":default:a.showAssetPanel=!1,a.showRiskPanel=!1,a.showTreatmentPanel=!1,a.showCharacteristicPanel=!1,a.showMetricPanel=!1,a.showProviderPanel=!1,a.showServicePanel=!0}},a.maxYear=(new Date).getFullYear(),a.isValidObject=function(a){try{var b=JSON.parse(a)}catch(c){return!1}return"object"==typeof b},a.saveForm=function(c,d){switch(c){case"service":var e={name:d.name,type:"service",provider:a.serviceData.provider,cloudType:a.serviceData.cloudType,metrics:a.metricsValues};b.save("service",e).then(function(){window.location.reload()},function(b){a.error=b});break;case"metric":d.type="metric",a.modifyExisting?b.update(a.chosenMetric._id,d).then(function(){window.location.reload()},function(b){a.error=b}):b.save("metric",d).then(function(){window.location.reload()},function(b){a.error=b});break;case"provider":d.type="provider",b.save("provider",d).then(function(){window.location.reload()},function(b){a.error=b});break;case"characteristic":var d={name:a.characteristicData.name,source:a.characteristicData.source,level:a.characteristicData.level,formula:a.characteristicData.formula.split(","),type:"characteristic",metrics:a.characteristicData.metrics};a.modifyExisting?b.update(a.characteristicData._id,d).then(function(){window.location.reload()},function(b){a.error=b}):b.save("characteristic",d).then(function(){window.location.reload()},function(b){a.error=b})}},a.clearForm=function(b){switch(b){case"metric":a.metricData={},a.modifyExisting=!1;break;case"characteristic":a.characteristicData={},a.modifyExisting=!1}},a.chosenMetric={},a.chosenCharacteristic={},a.updateForm=function(b){switch(b){case"metric":a.modifyExisting=!0,a.metricData.name=a.chosenMetric.name,a.metricData.options=JSON.stringify(a.chosenMetric.options);break;case"characteristic":a.modifyExisting=!0,a.characteristicData.name=a.chosenCharacteristic.name,a.characteristicData.source=a.chosenCharacteristic.source,a.characteristicData.level=a.chosenCharacteristic.level,a.characteristicData.formula=JSON.stringify(a.chosenCharacteristic.formula),a.characteristicData.metrics=a.chosenCharacteristic.metrics}},a.characteristicData.metrics=[],a.addMetricToCharacteristic=function(b,c){a.characteristicData.metrics.push(c.name)},a.removeMetricFromCharactersitic=function(b){delete a.characteristicData.metrics[b.name]}}]),dssApp.controller("mainController",["$scope","$upload","flash","$http","$q","$localStorage","AssetsService","ArangoDBService",function(a,b,c,d,e,f,g,h){var i=(new FileReader,new X2JS);a.clearSelection=function(){f.bsoia=[],f.toia=[],f.ta=[],f.risks=[],f.treatments=[],f.services=[],window.location.reload()},a.saveSessionFile=function(a){var b=angular.element(a.target);b.attr({download:"DSS_Session.json",href:"data:application/json;charset=utf-8,"+encodeURI(JSON.stringify(f)),target:"_blank"})},a.uploadSessionFile=function(){$("#uploadSessionFile").trigger("click")},a.loadLocalSessionContent=function(a){if(dssApp.isJSON(a)){var b=JSON.parse(a);f.assetsSelected=$rootScope.assetsSelected=b.assetsSelected,f.risksSelected=$rootScope.risksSelected=b.risksSelected,f.requirementsSelected=$rootScope.requirementsSelected=b.requirementsSelected}},a.showFileUploadDialog=function(a){$(a).trigger("click")},a.onFileSelect=function(a){var b=a[0];null!==b&&"undefined"!=typeof b?g.loadResourcesFromXML(b).then(function(a){h.validateSchema(a,function(b,d){if(b)c.error="Some error occurred while trying to upload your requirements";else if(d.correct){var e=i.xml_str2json(a).resourceModelExtension.resourceContainer;_.each(e,function(a){g.addTA(a)})}else c.error="Some error occurred while trying to upload your requirements"})}):c.error="Some error occurred while trying to upload your requirements",jQuery("#cloud-descriptor-file-selector").get(0).reset()}}]),dssApp.controller("cloudController",["$scope","ArangoDBService",function(a,b){a.proposals=b.getProposals()}]),dssApp.service("AssetsService",["flash","$q","$rootScope","$localStorage",function(a,b,c,d){var e=d.bsoia?d.bsoia:d.bsoia=[],f=d.toia?d.toia:d.toia=[],g=d.ta?d.ta:d.ta=[];this.addBSOIA=function(b){if(null===b||"undefined"==typeof b)return void(a.warn="No BSOIA was selected");var c=e.filter(function(a){return a.name===b.name}).length>0;c?a.warn="This asset has been already added!":e.push(b)},this.removeBSOIA=function(a){var b=-1;_.each(e,function(c,d){c.name==a.name&&(b=d)}),b>=0&&e.splice(b,1)},this.getBSOIA=function(){return e},this.addTOIA=function(b){if(null===b||"undefined"==typeof b)return void(a.warn="No TOIA was selected");var c=f.filter(function(a){return a.asset.name===b.name}).length>0;c?a.warn="This asset has been already added!":f.push({asset:b,bsoiaRelations:[]})},this.removeTOIA=function(a){var b=-1;_.each(f,function(c,d){c.asset.name==a.asset.name&&(b=d)}),b>=0&&f.splice(b,1)},this.getTOIA=function(){return f},this.existsTOIAByName=function(a){return f.filter(function(b){return b.asset.name==a}).length>0},this.existsBSOIAinTOIA=function(a,b){var c=f.filter(function(a){return a.asset.name==b});return c.length<1?!1:c[0].bsoiaRelations.filter(function(b){return b.name==a}).length>0},this.removeBSOIAfromTOIA=function(b,c){var d=-1;if(_.each(f,function(a,b){a.asset.name==c&&(d=b)}),0>d)return void(a.error=c+" does not exist");var e=-1;_.each(f[d].bsoiaRelations,function(a,c){a.name==b&&(e=c)}),e>=0&&f[d].bsoiaRelations.splice(e,1)},this.isBSOIALinked=function(a){return f.filter(function(b){return b.bsoiaRelations.filter(function(b){return b.name==a}).length>0}).length>0},this.updateTOIAbyName=function(a,b){var c=-1;_.each(f,function(b,d){b.asset.name==a&&(c=d)}),c>=0&&(f[c]=b)},this.addTA=function(b){if(null===b||"undefined"==typeof b)a.warn="No TA were selected";else{var c=g.filter(function(a){return a._id==b._id}).length>0;c?a.warn="This asset has been already added":g.push(b)}},this.removeTA=function(a){var b=-1;_.each(g,function(c,d){c._id==a._id&&(b=d)}),b>=0&&g.splice(b,1)},this.getTA=function(){return g},this.loadResourcesFromXML=function(a){{var c=new FileReader,d=b.defer();c.readAsText(a)}return c.onload=function(){d.resolve(c.result)},d.promise},this.removeAll=function(){e=[],f=[],g=[]}}]),dssApp.service("RisksService",["flash",function(a){var b=[],c={},d={};this.addRisk=function(c){if(null===c||"undefined"==typeof c)a.warn="No risk was selected";else{var d=b.filter(function(a){return c.destination.name==a.destination.name}).length>0;d?a.warn="This risk has been already added":b.push(c)}},this.removeRisk=function(a){var c=-1;_.each(b,function(b,d){a.destination.name==b.destination.name&&(c=d)}),c>=0&&b.splice(c,1)},this.getRisks=function(){return b},this.addRiskLikelihood=function(a,b){c[a+"_likelihood"]=parseInt(b)},this.removeRiskLikelihoodConsequence=function(a){var b=new RegExp(a+"[\\w\\s]*","i");for(key in c)b.exec(key)&&delete c[key];for(key in d)b.exec(key)&&delete d[key]},this.addRiskConsequence=function(a,b){c[a+"_consequence"]=parseInt(b)},this.addRiskTALikelihood=function(a,b,c){d[a+"_"+b+"_likelihood"]=parseInt(c)},this.addRiskTAConsequence=function(a,b,c){d[a+"_"+b+"_consequence"]=parseInt(c)},this.removeRiskTALikelihoodConsequence=function(a){var b=new RegExp("[\\w\\s]+_"+a+"_[\\w\\s]+","i");for(key in d)b.exec(key)&&delete d[key]},this.getRisksLikelihoodConsequence=function(){return c},this.getRisksTALikelihoodConsequence=function(){return d}}]),dssApp.service("ArangoDBService",["$http","$q","AssetsService","RisksService",function(a,b,c,d){a.defaults.headers.common.Authorization="Basic "+btoa("root:CATech2014!"),this.ARANGODB_BASE_URL="http://dss.jarandaf.com:8529/_db/dss/dss/",this.XSD_SERVICE_BASE_URL="http://dss.jarandaf.com:3999/";var e=this;this.FOXX_API={getUrl:function(a){return e.ARANGODB_BASE_URL+"crud/nodes/"+a},postUrl:function(){return e.ARANGODB_BASE_URL+"crud/nodes"},getBSOIA:function(){return e.ARANGODB_BASE_URL+"crud/nodes/bsoia"},getTOIA:function(){return e.ARANGODB_BASE_URL+"crud/nodes/toia"},getRisks:function(){return e.ARANGODB_BASE_URL+"crud/nodes/risk"},getTreatments:function(){return e.ARANGODB_BASE_URL+"crud/nodes/treatment"},getPotentialRisks:function(a,b){var c=firstToia=!0,d=e.ARANGODB_BASE_URL+"graph/potentialRisks?";return _.each(a,function(a){c?(c=!1,d+="bsoias="+a.name):d+=","+a.name}),_.each(b,function(a){firstToia?(firstToia=!1,d+="&toias="+a.asset.name):d+=","+a.asset.name}),d},getPotentialTreatments:function(a){var b=!0,c=e.ARANGODB_BASE_URL+"graph/potentialTreatments?";return _.each(a,function(a){b?(b=!1,c+="risks="+a.destination.name):c+=","+a.destination.name}),c},validateDocument:function(){return e.XSD_SERVICE_BASE_URL+"validateDSSXML"}},this.getBSOIA=function(b){a({method:"GET",url:e.FOXX_API.getBSOIA()}).success(function(a){b(null,a)}).error(function(a){b(a,null)})},this.getTOIA=function(b){a({method:"GET",url:e.FOXX_API.getTOIA(),headers:{}}).success(function(a){b(null,a)}).error(function(a){b(a,null)})},this.getRisks=function(b){a({method:"GET",url:e.FOXX_API.getRisks()}).success(function(a){b(null,a)}).error(function(a){b(a,null)})},this.getTreatments=function(b){a({method:"GET",url:e.FOXX_API.getTreatments()}).success(function(a){b(null,a)}).error(function(a){b(a,null)})},this.getPotentialRisks=function(b){a({method:"GET",url:e.FOXX_API.getPotentialRisks(c.getBSOIA(),c.getTA())}).success(function(a){b(null,a)}).error(function(a){b(a,null)})},this.getPotentialTreatments=function(b){a({method:"GET",url:e.FOXX_API.getPotentialTreatments(d.getRisks())}).success(function(a){b(null,a)}).error(function(a){b(a,null)})},this.getAll=function(b,c){a.get(e.FOXX_API.getUrl(b)).success(function(a){c(null,a)}).error(function(a){c(a,null)})},this.getProposals=function(){return[{name:"Windows Azure",description:"A brief and fancy description #1",url:"http://azure.microsoft.com",logo:"http://blog.alebanzas.com.ar/wp-content/uploads/2011/08/7217.Windows-Azure-logo-v_6556EF52.png",score:81.8},{name:"Amazon EC2",description:"A brief and fancy description #2",url:"http://aws.amazon.com",logo:"http://zentera.net/wp-content/uploads/2013/08/AWSLogo.png",score:75.2},{name:"Rackspace",description:"A brief and fancy description #3",url:"http://www.rackspace.com",logo:"http://www.hatchpitch.com/wp-content/uploads/2013/03/Rackspace_Cloud_Company_Logo_clr.png",score:43.5}]},this.save=function(c,d){var f=b.defer();return a.post(e.FOXX_API.postUrl(),d).success(function(a){f.resolve(a)}).error(function(a){f.reject(a)}),f.promise},this.update=function(c,d){var f=b.defer();return a.put(e.FOXX_API.getUrl(c),d).success(function(a){f.resolve(a)}).error(function(a){f.reject(a)}),f.promise},this.validateSchema=function(b,c){a({method:"POST",url:e.FOXX_API.validateDocument(),data:{xmlString:b}}).success(function(a){c(null,a)}).error(function(a){c(a,null)})}}]),dssApp.service("TreatmentsService",["flash",function(a){var b=[],c={};this.addTreatment=function(c){if(null===c||"undefined"==typeof c)a.warn="No treatment was selected";else{var d=b.filter(function(a){return c.destination.name==a.destination.name}).length>0;d?a.warn="This treatment has been already added":b.push(c)}},this.removeTreatment=function(a){var c=-1;_.each(b,function(b,d){a.destination.name==b.destination.name&&(c=d)}),c>=0&&b.splice(c,1)},this.getTreatments=function(){return b},this.addTreatmentValue=function(a,b){console.log("adding treatment value",a,b),c[a]=b},this.removeTreatmentValue=function(a){console.log("removing treatment value",a),delete c[a]},this.getTreatmentsValues=function(){return c}}]),dssApp.filter("capitalize",function(){return function(a){return a.substring(0,1).toUpperCase()+a.substring(1)}}),dssApp.filter("replaceSpacesWithDash",function(){return function(a){return a.replace(/\ /g,"_")}}),dssApp.filter("replaceDotWithDash",function(){return function(a){return a.replace(/\./g,"_")}}),dssApp.filter("replaceDashWithSpace",function(){return function(a){return a.replace(/_/g," ")}}),dssApp.filter("replaceDashWithDot",function(){return function(a){return a.replace(/_/g,".")}}),dssApp.filter("unique",function(){return function(a,b){var c,d;return b===!1?a:((b||angular.isUndefined(b))&&angular.isArray(a)&&(d=[],c=function(a){return angular.isObject(a)&&angular.isString(b)?a[b]:a},angular.forEach(a,function(b){var e,f,g=!1;for(e=0,f=d.length;f>e;e++){var h=d[e];if(angular.equals(c(h),c(b))){g=!0;break}}g||d.push(b),a=d})),a)}}),dssApp.directive("onReadFile",["$parse",function(a){return{restrict:"A",scope:!1,link:function(b,c,d){var e=a(d.onReadFile);c.on("change",function(a){var c=new FileReader;c.onload=function(a){b.$apply(function(){e(b,{$fileContent:a.target.result})})},c.readAsText((a.srcElement||a.target).files[0])})}}}]),dssApp.isJSON=function(a){if("string"==typeof a){try{JSON.parse(a)}catch(b){return!1}return!0}return!1},dssApp.directive("onRepeatDone",function(){return{restrict:"A",link:function(a,b){a.$emit("repeatDone",b)}}}),dssApp.directive("onRisksType",["$timeout",function(a){return{restrict:"A",scope:!1,link:function(b,c){a(function(){b.$emit("sliderValueChanged",{slider:$(c.children().first()),value:$(c.children().first()).val()})},10)}}}]),dssApp.directive("treatRadio",function(){return{restrict:"E",scope:{item:"="},templateUrl:"partials/treatments/treatments-radio.html",link:function(a){a.options=a.$eval("{"+a.item.destination.options+"}"),a.aux="",a.change=function(b){var c=null;for(optionValue in a.options)if(a.options[optionValue]==b){c=optionValue;break}c&&a.$emit("treatmentValueChanged",{name:a.item.destination.name,value:c})}}}}),dssApp.directive("treatSelect",function(){return{restrict:"E",scope:{item:"="},templateUrl:"partials/treatments/treatments-select.html",link:function(a){a.options=a.$eval("{"+a.item.destination.options+"}"),a.change=function(b){var c=null;for(optionValue in a.options)if(a.options[optionValue]==b){c=optionValue;break}c&&a.$emit("treatmentValueChanged",{name:a.item.destination.name,value:c})}}}});
//# sourceMappingURL=app.min.map