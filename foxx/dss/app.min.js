/*! modaclouds-dss - v0.0.1 - author: Jacek Dominiak - 2014-07-15 */
$("#dssSlides").carousel("pause",{wrap:!1}).on("slid.bs.carousel",function(){var a=$(".topMenu"),b=$(this).find(".active"),c=$(".sticky-bottom"),d=c.find(".slide-services");a.find("blockquote p").removeClass("active"),b.hasClass("bsoia-slide")?(a.find(".bsoia-slide blockquote p").addClass("active"),c.find(".slide-prev").prop("disabled",!0),c.find(".slide-next").prop("disabled",!1),c.find(".slide-next").css("display","inline"),d.css("display","none")):b.hasClass("toia-slide")?(a.find(".toia-slide blockquote p").addClass("active"),c.find(".slide-prev").prop("disabled",!1),c.find(".slide-next").prop("disabled",!1),c.find(".slide-next").css("display","inline"),d.css("display","none")):b.hasClass("ta-slide")?(a.find(".ta-slide blockquote p").addClass("active"),c.find(".slide-prev").prop("disabled",!1),c.find(".slide-next").prop("disabled",!1),c.find(".slide-next").css("display","inline"),d.css("display","none")):b.hasClass("risks-slide")?(a.find(".risks-slide blockquote p").addClass("active"),c.find(".slide-prev").prop("disabled",!1),c.find(".slide-next").prop("disabled",!1),c.find(".slide-next").css("display","inline"),d.css("display","none")):b.hasClass("treatments-slide")?(a.find(".treatments-slide blockquote p").addClass("active"),c.find(".slide-prev").prop("disabled",!1),c.find(".slide-next").prop("disabled",!1),c.find(".slide-next").css("display","inline"),d.css("display","none")):(a.find(".services-slide blockquote p").addClass("active"),c.find(".slide-prev").prop("disabled",!1),c.find(".slide-next").css("display","none"),d.css("display","inline  "))});var dssApp=angular.module("dssApp",["ngStorage","angular-flash.service","angular-flash.flash-alert-directive","ngDragDrop","angular-loading-bar","angularFileUpload","frapontillo.bootstrap-switch"]).config(["cfpLoadingBarProvider",function(a){a.includeSpinner=!1}]);$("body").on("mouseover",".list-group > .selected-asset",function(){$(this).find(".remove-asset").show(),$(this).find(".remove-bsoia-in-toia").show()}),$("body").on("mouseout",".list-group > .selected-asset",function(){$(this).find(".remove-asset").hide(),$(this).find(".remove-bsoia-in-toia").hide()}),$("body").on("mouseover",".list-group > .selected-risk",function(){$(this).find(".remove-risk").show()}),$("body").on("mouseout",".list-group > .selected-risk",function(){$(this).find(".remove-risk").hide()}),$("body").on("mouseover",".list-group > .dropzone",function(){$(this).find(".remove-bsoia-in-toia-asset").show()}),$("body").on("mouseout",".list-group > .dropzone",function(){$(this).find(".remove-bsoia-in-toia-asset").hide()}),$('select[label="assets"]').select2({placeholder:"Select an asset"}),$('select[label="risks"]').select2({placeholder:"Select an asset"}),dssApp.controller("bsoiaController",["$scope","$rootScope","$localStorage","AssetsService","ArangoDBService","flash",function(a,b,c,d,e,f){a.bsoiaAssets=c.bsoiaAssets=[],a.bsoiaAssetsSelected=c.bsoiaAssetsSelected=d.getBSOIA(),a.addBsoiaAsset=function(a){d.addBSOIA(a)},a.removeBsoiaAsset=function(a){d.removeBSOIA(a)},a.$watch(function(){return d.getBSOIA()},function(){b.$broadcast("bsoiaChanged")},!0),e.getBSOIA(function(b,c){b?f.error="An error occurred while trying to fetch BSOIA assets from database":a.bsoiaAssets=c._documents})}]),dssApp.controller("toiaController",["$scope","$rootScope","$localStorage","AssetsService","ArangoDBService","flash",function(a,b,c,d,e,f){a.toiaAssets=c.toiaAssets=[],a.toiaAssetsSelected=d.getTOIA(),a.bsoiaAssetsSelected=d.getBSOIA(),a.addToiaAsset=function(a){d.addTOIA(a)},a.removeToiaAsset=function(a){d.removeTOIA(a)},a.removeBsoiaFromToiaAsset=function(a,b){d.removeBSOIAfromTOIA(a.name,b.asset.name)},a.bsoiaDropped=function(a,b,c){d.existsBSOIAinTOIA(b.name,c.asset.name)?f.warn="BSOIA "+b.name+" already added in TOIA "+c.asset.name:(c.bsoiaRelations.push(b),d.updateTOIAbyName(c.asset.name,c))},a.isBsoiaEverUsed=function(a){return d.isBSOIALinked(a.name)},a.$watch(function(){return d.getTOIA()},function(){b.$broadcast("toiaChanged")},!0),e.getTOIA(function(b,c){b?f.error="An error occurred while trying to fetch BSOIA assets from database":a.toiaAssets=c._documents})}]),dssApp.controller("taController",["$scope","AssetsService",function(a,b){a.taAssets=b.getTA(),a.removeTaAsset=function(a){b.removeTA(a)}}]),dssApp.controller("risksController",["$scope","ArangoDBService","flash","AssetsService","$timeout",function(a,b,c,d){a.potentialRisks=[],a.risksSelected=d.getRisks(),a.switch={isSwitchSelected:!0},a.taAssets=d.getTA(),a.$on("bsoiaChanged",function(){b.getPotentialRisks(function(b,d){if(b)c.error="Some error occurred when trying to compute potential risks after selected BSOIA changed";else{var e=[],f=[];_.each(d._documents,function(a){-1===e.indexOf(a.destination.name)&&(e.push(a.destination.name),f.push(a))}),a.potentialRisks=f}})}),a.$on("toiaChanged",function(){b.getPotentialRisks(function(b,d){if(b)c.error="Some error occurred when trying to compute potential risks after selected TOIA changed";else{var e=[],f=[];_.each(d._documents,function(a){-1===e.indexOf(a.destination.name)&&(e.push(a.destination.name),f.push(a))}),a.potentialRisks=f}})}),a.$watch("taAssets",function(b){0==b.length&&(a.switch.isSwitchSelected=!0),a.taAssets=b}),a.toggleActivation=function(){if(!a.switch.isSwitchSelected){if(0==a.taAssets.length)return c.warn="You can't define risks per each tangible asset since you did not specify any of them",void(a.switch.isSwitchSelected=!0);a.switch.isSwitchSelected=!1}},a.addRisk=function(a){d.addRisk(a)},a.removeRisk=function(a){d.removeRisk(a)}}]),dssApp.controller("mainController",["$scope","$upload","flash","AssetsService",function(a,b,c,d){var e=(new FileReader,new X2JS);a.clearSelection=function(){$localStorage.bsoiaAssetsSelected=$rootScope.bsoiaAssetsSelected=[],$localStorage.toiaAssetsSelected=$rootScope.toiaAssetsSelected=[],$localStorage.risksSelected=$rootScope.risksSelected=[],$localStorage.treatmentsSelected=$rootScope.treatmentsSelected=[]},a.saveSessionFile=function(a){var b=angular.element(a.target);b.attr({download:"DSS_Session.json",href:"data:application/json;charset=utf-8,"+encodeURI(JSON.stringify($localStorage)),target:"_blank"})},a.uploadSessionFile=function(){$("#uploadSessionFile").trigger("click")},a.loadLocalSessionContent=function(a){if(dssApp.isJSON(a)){var b=JSON.parse(a);$localStorage.assetsSelected=$rootScope.assetsSelected=b.assetsSelected,$localStorage.risksSelected=$rootScope.risksSelected=b.risksSelected,$localStorage.requirementsSelected=$rootScope.requirementsSelected=b.requirementsSelected}},a.showFileUploadDialog=function(a){$(a).trigger("click")},a.onFileSelect=function(a){var b=a[0];null!==b&&"undefined"!=typeof b?d.loadResourcesFromXML(b).then(function(a){var b=e.xml_str2json(a).resourceModelExtension.resourceContainer;_.each(b,function(a){d.addTA(a)})}):c.error="Some error occurred while trying to upload your requirements",jQuery("#cloud-descriptor-file-selector").get(0).reset()}}]),dssApp.service("AssetsService",["flash","$q","$rootScope",function(a,b){var c=[],d=[],e=[],f=[];this.addBSOIA=function(b){if(null===b||"undefined"==typeof b)return void(a.warn="No BSOIA was selected");var d=c.filter(function(a){return a.name===b.name}).length>0;d?a.warn="This asset has been already added!":c.push(b)},this.removeBSOIA=function(a){var b=-1;_.each(c,function(c,d){c.name==a.name&&(b=d)}),b>=0&&c.splice(b,1)},this.getBSOIA=function(){return c},this.addTOIA=function(b){if(null===b||"undefined"==typeof b)return void(a.warn="No TOIA was selected");var c=d.filter(function(a){return a.asset.name===b.name}).length>0;c?a.warn="This asset has been already added!":d.push({asset:b,bsoiaRelations:[]})},this.removeTOIA=function(a){var b=-1;_.each(d,function(c,d){c.asset.name==a.asset.name&&(b=d)}),b>=0&&d.splice(b,1)},this.getTOIA=function(){return d},this.existsTOIAByName=function(a){d.filter(function(b){return b.name==a}).length>0},this.existsBSOIAinTOIA=function(a,b){var c=d.filter(function(a){return a.asset.name==b});return c.length<1?!1:c[0].bsoiaRelations.filter(function(b){return b.name==a}).length>0},this.removeBSOIAfromTOIA=function(b,c){var e=-1;if(_.each(d,function(a,b){a.asset.name==c&&(e=b)}),0>e)return void(a.error=c+" does not exist");var f=-1;_.each(d[e].bsoiaRelations,function(a,c){a.name==b&&(f=c)}),f>=0&&d[e].bsoiaRelations.splice(f,1)},this.isBSOIALinked=function(a){return d.filter(function(b){return b.bsoiaRelations.filter(function(b){return b.name==a}).length>0}).length>0},this.updateTOIAbyName=function(a,b){var c=-1;_.each(d,function(b,d){b.name==a&&(c=d)}),c>=0&&(d[c]=b)},this.addTA=function(b){if(null===b||"undefined"==typeof b)a.warn="No TA were selected";else{var c=e.filter(function(a){return a._id==b._id}).length>0;c?a.warn="This asset has been already added":e.push(b)}},this.removeTA=function(a){var b=-1;_.each(e,function(c,d){c._id==a._id&&(b=d)}),b>=0&&e.splice(b,1)},this.getTA=function(){return e},this.loadResourcesFromXML=function(a){{var c=new FileReader,d=b.defer();c.readAsText(a)}return c.onload=function(){d.resolve(c.result)},d.promise},this.addRisk=function(b){if(null===b||"undefined"==typeof b)a.warn="No risk was selected";else{var c=f.filter(function(a){return b.destination.name==a.destination.name}).length>0;c?a.warn="This risk has been already added":f.push(b)}},this.removeRisk=function(a){var b=-1;_.each(f,function(c,d){a.destination.name==c.destination.name&&(b=d)}),b>=0&&f.splice(b,1)},this.getRisks=function(){return f}}]),dssApp.service("ArangoDBService",["$http","AssetsService",function(a,b){var c="http://localhost:8529/_db/_system/dss/api/",d={getBSOIA:function(){return c+"assets/bsoia"},getTOIA:function(){return c+"assets/toia"},getRisks:function(){return c+"risks"},getTreatments:function(){return c+"treatments"},getPotentialRisks:function(a,b){var d=firstToia=!0,e=c+"potentialRisks?";return _.each(a,function(a){d?(d=!1,e+="bsoias="+a.name):e+=","+a.name}),_.each(b,function(a){firstToia?(firstToia=!1,e+="&toias="+a.asset.name):e+=","+a.asset.name}),e}};this.getBSOIA=function(b){a({method:"GET",url:d.getBSOIA()}).success(function(a){b(null,a)}).error(function(a){b(a,null)})},this.getTOIA=function(b){a({method:"GET",url:d.getTOIA()}).success(function(a){b(null,a)}).error(function(a){b(a,null)})},this.getRisks=function(b){a({method:"GET",url:d.getRisks()}).success(function(a){b(null,a)}).error(function(a){b(a,null)})},this.getTreatments=function(b){a({method:"GET",url:d.getTreatments()}).success(function(a){b(null,a)}).error(function(a){b(a,null)})},this.getPotentialRisks=function(c){a({method:"GET",url:d.getPotentialRisks(b.getBSOIA(),b.getTA())}).success(function(a){c(null,a)}).error(function(a){c(a,null)})}}]),dssApp.filter("capitalize",function(){return function(a){return a.substring(0,1).toUpperCase()+a.substring(1)}}),dssApp.filter("replaceSpacesWithDash",function(){return function(a){return a.replace(/\ /g,"_")}}),dssApp.filter("replaceDotWithDash",function(){return function(a){return a.replace(/\./g,"_")}}),dssApp.filter("replaceDashWithSpace",function(){return function(a){return a.replace(/_/g," ")}}),dssApp.filter("replaceDashWithDot",function(){return function(a){return a.replace(/_/g,".")}}),dssApp.filter("unique",function(){return function(a,b){var c,d;return b===!1?a:((b||angular.isUndefined(b))&&angular.isArray(a)&&(d=[],c=function(a){return angular.isObject(a)&&angular.isString(b)?a[b]:a},angular.forEach(a,function(b){var e,f,g=!1;for(e=0,f=d.length;f>e;e++){var h=d[e];if(angular.equals(c(h),c(b))){g=!0;break}}g||d.push(b),a=d})),a)}}),dssApp.directive("onReadFile",["$parse",function(a){return{restrict:"A",scope:!1,link:function(b,c,d){var e=a(d.onReadFile);c.on("change",function(a){var c=new FileReader;c.onload=function(a){b.$apply(function(){e(b,{$fileContent:a.target.result})})},c.readAsText((a.srcElement||a.target).files[0])})}}}]),dssApp.isJSON=function(a){if("string"==typeof a){try{JSON.parse(a)}catch(b){return!1}return!0}return!1},dssApp.controller("requirementsController",["$scope","$rootScope","$localStorage",function(a,b,c){b.requirementsSelected=c.requirementsSelected||[],a.requirement="",a.$watch("requirementsSelected",function(a){c.requirementsSelected=a})}]),dssApp.directive("reqInput",function(){return{restrict:"E",replace:!0,link:function(a,b){var c,d,e;return c=a.$eval("{"+a.risk.destination.attributes+"}"),d=c.placeholder||"",e=c.type||"text",b.html('<label for="'+a.risk.destination.name+'">'+a.risk.destination.name+' <span data-tooltip class="has-tip tip-top" title="'+a.risk.destination.definition+'"><i class="fi-lightbulb"></i></span></label><input name="'+a.risk.destination.linkName+'" type="'+e+'" class="large-12 columns query" placeholder="'+d+'">'),b.bind("change",function(){return a.change()})}}}),dssApp.directive("reqRadio",function(){return{restrict:"E",replace:!0,link:function(a,b){var c;return c=a.$eval("{"+a.risk.destination.attributes+"}"),b.html("<label>"+a.risk.destination.name+'</label><label class="switch-light well" onclick=""><input type="checkbox"/><span><span>'+c[0]+"</span><span>"+c[1]+'</span></span><a class="btn btn-success"></a></label>'),b.bind("click",function(){return a.change()})}}}),dssApp.directive("reqSelect",function(){return{restrict:"E",replace:!0,link:function(a,b){var c,d;return c=a.$eval("{"+a.risk.destination.options+"}"),d='<option value="none">-- select --</option>',angular.forEach(c,function(a,b){d=d+'<option value="'+b+'">'+a+"</option>"}),b.html('<label for="'+a.risk.destination.name+'">'+a.risk.destination.name+' <span data-tooltip class="has-tip tip-top" title="'+a.risk.destination.name+'"><i class="fi-lightbulb"></i></span></label><select name="'+a.risk.destination.linkName+'" class="query form-control form">'+d+"</select>"),b.bind("change",function(){return a.change()})}}}),dssApp.directive("reqSlider",function(){return{restrict:"E",replace:!0,link:function(a,b){var c;return c=a.$eval("{"+a.risk.destination.attributes+"}"),b.html('        <label style="margin-bottom: 5px;" class="def-tip" data-container="body" data-toggle="popover" data-placement="right" data-content="Vivamus sagittis lacus vel augue laoreet rutrum faucibus.">'+a.risk.destination.name+'<span title="'+a.risk.destination.definition+'"         <i class="fi-lightbulb"></i></span></label>        <span class="label secondary radius right requirementValue">-</span>        <div class="row"><div class="col-lg-6"><p style="margin-bottom: 15px">Likelihood: </p><div style="width: 80%; margin-bottom: 15px;" class="noUiSlider"></div></div><div class="col-lg-6"><p style="margin-bottom: 15px;">Consequence :</p><div style="width: 80%; margin-bottom: 15px;" class="noUiSlider"></div></div></div>      '),$(".def-tip").popover({toggle:"hover"}),b.find("div.noUiSlider").noUiSlider({range:{min:0,max:10},start:c.start||0,step:c.step||1,handles:c.handles||1,slide:function(){return $(this).prev("span.requirementValue").text($(this).val())}})}}}),dssApp.directive("riskSlider",function(){return{restrict:"E",templateUrl:"dss/partials/risks/slider.html",scope:{risk:"=",multiple:"=",taAssets:"="},link:function(a,b){var c={VERY_LOW:{"class":"risk-very-low",name:"Very low"},LOW:{"class":"risk-low",name:"Low"},NORMAL:{"class":"risk-normal",name:"Normal"},HIGH:{"class":"risk-high",name:"High"},VERY_HIGH:{"class":"risk-very-high",name:"Very high"}},d=function(a){return 2>a?c.VERY_LOW.class:2==a||3==a?c.LOW.class:4==a||5==a||6==a?c.NORMAL.class:7==a||8==a?c.HIGH.class:a>8?c.VERY_HIGH.class:void 0},e=function(a){return 2>a?c.VERY_LOW.name:2==a||3==a?c.LOW.name:4==a||5==a||6==a?c.NORMAL.name:7==a||8==a?c.HIGH.name:a>8?c.VERY_HIGH.name:void 0},f=function(a){for(category in c)a.removeClass(c[category].class);return a},g=a.$eval("{"+a.risk.destination.attributes+"}");return $(".def-tip").popover({toggle:"hover"}),b.find("div.noUiSlider").noUiSlider({range:{min:g.range[0],max:g.range[1]},start:g.start||0,step:g.step||1,handles:g.handles||1}).on({slide:function(){var a=$(this).prev().prev().siblings("span.requirement-value"),b=$(this).val();return f(a).addClass(d(b)).text(e(b))}})}}});
//# sourceMappingURL=app.min.map